<section class="card">
  <div class="today">
    <div class="mast">
      <div>
        <h1>Morning Gist</h1>

        <div class="meta">
          {{ metaText }}
        </div>

        <div class="actions" aria-label="Actions">
          <button class="secondary" type="button" (click)="onPrint()">
            Print
          </button>

          <button class="secondary" type="button" (click)="onResend()">
            Resend
          </button>

          <button class="secondary" type="button" (click)="onEditTomorrow()">
            Edit tomorrow
          </button>

          <button
            class="secondary"
            type="button"
            (click)="toggleSerif()"
            [attr.aria-pressed]="isSerif"
          >
            {{ isSerif ? "Serif" : "Sans" }}
          </button>
        </div>
      </div>

      <div class="status">
        {{ statusText }}
      </div>
    </div>

    <div class="grid">
      <!-- MAIN PAPER -->
      <ng-container *ngIf="gist$ | async as gist; else noGist">
        <div
          class="paper"
          [class.serif]="isSerif"
          aria-label="Morning Gist (print-native)"
        >
          <p class="kicker">Today at a glance</p>

          <p><b>Weather:</b> {{ gist.weatherSummary }}</p>

          <p *ngIf="gist.firstEvent; else noFirstEvent">
            <b>First event:</b> {{ gist.firstEvent }}
          </p>
          <ng-template #noFirstEvent>
            <p><b>First event:</b> —</p>
          </ng-template>

          <h2>Your day</h2>
          <ul>
            <li *ngIf="!gist.dayItems?.length" style="color: var(--muted)">
              No day items yet.
            </li>

            <li *ngFor="let item of gist.dayItems">
              <ng-container *ngIf="item.time as t; else noTime">
                <b>{{ t }}</b>
              </ng-container>
              <ng-template #noTime>
                <b>—</b>
              </ng-template>

              {{ item.title }}

              <div class="why" *ngIf="item.note">
                {{ item.note }}
              </div>
            </li>
          </ul>

          <h2>The world</h2>
          <ul>
            <li *ngIf="!gist.worldItems?.length" style="color: var(--muted)">
              No world items yet.
            </li>

            <li *ngFor="let w of gist.worldItems">
              {{ w.headline }}
              <div class="why">{{ w.implication }}</div>
            </li>
          </ul>

          <h2>The gist</h2>
          <ul>
            <li *ngIf="!gist.gistBullets?.length" style="color: var(--muted)">
              No gist bullets yet.
            </li>

            <li *ngFor="let b of gist.gistBullets">
              {{ b }}
            </li>
          </ul>

          <h2>One thing</h2>
          <p *ngIf="gist.oneThing; else noOneThing">
            <b>{{ gist.oneThing }}</b>
          </p>
          <ng-template #noOneThing>
            <p><b>—</b></p>
          </ng-template>

          <p class="why">
            Constraint: If it can’t fit on paper, it doesn’t belong.
          </p>
        </div>
      </ng-container>

      <ng-template #noGist>
        <div class="card" style="padding: 16px">
          <div style="font-weight: 650">No Morning Gist found.</div>
          <div class="sub" style="margin: 8px 0 0">
            Generate one (scheduled or “Run now”), then refresh.
          </div>
        </div>
      </ng-template>

      <!-- DELIVERY SNAPSHOT -->
      <aside class="card side" aria-label="Delivery snapshot">
        <h3>Delivery</h3>

        <!-- You can keep this static for now; we can wire it from user doc later -->
        <div class="kv">
          <span>Mode</span><b>Fax + Web</b> <span>Fax</span
          ><b>(•••) •••-1234</b> <span>Schedule</span
          ><b>Weekdays 7:30 AM ET</b> <span>Format</span
          ><b>Standard • 2 pages max</b>
        </div>

        <div class="log" aria-label="Delivery log">
          <ng-container *ngIf="deliveryLogs$ | async as logs; else logsLoading">
            <div *ngIf="logs.length === 0" style="color: var(--muted)">
              No delivery events yet.
            </div>

            <div class="row" *ngFor="let entry of logs">
              <span>{{ entry.createdAtLabel }}</span>
              <span
                [ngClass]="{
                  ok: entry.statusClass === 'ok',
                  warn: entry.statusClass === 'warn',
                  bad: entry.statusClass === 'bad'
                }"
              >
                {{ entry.status }}
              </span>
            </div>
          </ng-container>

          <ng-template #logsLoading>
            <div style="color: var(--muted)">Loading…</div>
          </ng-template>
        </div>

        <div class="actions" style="margin-top: 12px">
          <button class="secondary" type="button" (click)="goToDelivery()">
            Change schedule
          </button>
          <button class="secondary" type="button" (click)="goToDelivery()">
            Update fax
          </button>
        </div>
      </aside>
    </div>
  </div>
</section>
