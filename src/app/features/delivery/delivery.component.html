<section class="card page" data-route="delivery">
  <h1>Delivery</h1>
  <div class="sub">Trust and logistics. Clear logs. One-click resend.</div>

  <ng-container *ngIf="logs$ | async as logs; else loading">
    <table class="table" aria-label="Delivery log table">
      <thead>
        <tr>
          <th style="width: 180px">When</th>
          <th style="width: 120px">Type</th>
          <th style="width: 140px">Method</th>
          <th>Status</th>
          <th style="width: 120px">Pages</th>
          <th style="width: 160px">Action</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngIf="logs.length === 0">
          <td colspan="6" style="padding: 14px; color: var(--muted)">
            No delivery events yet.
          </td>
        </tr>

        <tr *ngFor="let log of logs">
          <!-- When -->
          <td>
            <!-- createdAt is a Firestore Timestamp; we’ll convert in TS -->
            {{ log.createdAtLabel }}
          </td>

          <!-- Type -->
          <td style="text-transform: capitalize">
            {{ log.type }}
          </td>

          <!-- Method -->
          <td style="text-transform: uppercase">
            {{ log.method }}
          </td>

          <!-- Status -->
          <td
            [ngClass]="{
              ok: log.statusClass === 'ok',
              warn: log.statusClass === 'warn',
              bad: log.statusClass === 'bad'
            }"
            style="text-transform: capitalize"
          >
            {{ log.status }}
          </td>

          <!-- Pages -->
          <td>
            {{ log.pages ?? "—" }}
          </td>

          <!-- Action -->
          <td>
            <ng-container [ngSwitch]="log.type">
              <!-- Morning -->
              <ng-container *ngSwitchCase="'morning'">
                <button class="secondary" (click)="resend(log)">Resend</button>
              </ng-container>

              <!-- Evening -->
              <ng-container *ngSwitchCase="'evening'">
                <button class="secondary" (click)="view(log)">View</button>
              </ng-container>

              <!-- Fallback -->
              <ng-container *ngSwitchDefault>
                <button class="secondary" (click)="view(log)">View</button>
              </ng-container>
            </ng-container>

            <!-- If failed, show Retry instead -->
            <button
              *ngIf="(log.status || '').toLowerCase() === 'failed'"
              class="secondary"
              style="margin-left: 8px"
              (click)="retry(log)"
            >
              Retry
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div style="height: 16px"></div>

    <!-- Keep setup static for MVP (we can wire it later from user doc) -->
    <div class="card" style="padding: 16px">
      <h1 style="font-size: 16px; margin: 0 0 6px">Delivery setup</h1>
      <div class="sub" style="margin-bottom: 0">Set it once. Forget it.</div>

      <div
        style="
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
          margin-top: 12px;
        "
      >
        <div
          class="card"
          style="padding: 14px; border-radius: var(--radius-sm)"
        >
          <div style="font-weight: 600">Morning schedule</div>
          <div class="sub">Weekdays • 7:30 AM ET</div>
          <button class="secondary" (click)="editSchedule()">
            Edit schedule
          </button>
        </div>

        <div
          class="card"
          style="padding: 14px; border-radius: var(--radius-sm)"
        >
          <div style="font-weight: 600">Inbound fax number</div>
          <div class="sub">(•••) •••-9876 • Connected</div>
          <button class="secondary" (click)="updateFax()">Update number</button>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #loading>
    <div class="card" style="padding: 16px">
      <div style="font-weight: 600">Loading delivery logs…</div>
      <div class="sub" style="margin-bottom: 0">Fetching from Firestore.</div>
    </div>
  </ng-template>
</section>
